name: Cargo Test
on:
  push:
    branches:
      - master
      - renovate/*

jobs:
  Cargo-Test:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v3
    - uses: dtolnay/rust-toolchain@stable
    - uses: actions/cache@v3
      with:
        path: |
          ~/.cargo/bin/
          ~/.cargo/registry/index/
          ~/.cargo/registry/cache/
          ~/.cargo/git/db/
          target/      
        key: ${{ runner.os }}-cargo-${{ hashFiles('**/Cargo.lock') }}
    - name: cargo test
      run: cargo test

  Flutter-Build-Test:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v3
    - name: Set Up Java
      uses: actions/setup-java@v3.12.0
      with:
        distribution: 'oracle'
        java-version: '17'
    - name: add jq
      run: |
        apt-get update && apt-get install -y jq
        git config --global --add safe.directory /opt/hostedtoolcache/flutter
    - name: Set Up Flutter
      uses: subosito/flutter-action@v2
      with:
        channel: 'stable' 
    - name: install dependencies
      run: flutter pub get
    - name: build
      run: flutter build linux